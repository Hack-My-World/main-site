<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>HITCON-CTF-Writeups</title>

    <!-- Bootstrap Core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../css/clean-blog.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/custom.css">

    <!-- Prism -->
    <link rel="stylesheet" href="../css/prism.css" >
    <script src="../js/prism.js"> </script>

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://kabla.me/blog/">Kablaa!</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="http://kabla.me/blog">Home</a>
                    </li>
                    <li>
                        <a href="http://kabla.me/blog/writeups">Writeups</a>
                    </li>
                    <li>
                         <a href="http://kabla.me/blog/projects">Projects</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header class="intro-header" >
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>HITCON CTF 2016</h1>
                        <h2><img src="../img/hitcon-logo.png" alt="tum" align="right"></h2>
                        <span class="meta">Posted by <a href="#">kablaa</a> October, 2016</span>

                    </div>

                </div>
            </div>
        </div>
    </header>

    <!-- begn challenge list -->
    <div class="container">
        <div class = "row">
                <div class="post-body col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-2">
                    <div claa = "list-group">
                        <a href="#flame" class = "list-group-item">Flame <span class ="badge">PPC-150</span></a>
                        <a href="#hand-crafted" class = "list-group-item">Handcrafted pyc <span class ="badge">Reversing-50</span></a>
                    </div>
                </div>
        </div>
    </div>
    <!-- Post Content -->
    <article>
        <div class="container">
            <div class="row">
                <div class="post-body col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-2">
                    <h1 id="flame">Flame (PPC-150)</h1>

                    This was my first encounter with Power PC, so this challenge was definitely fun learning experience for me. Here is my best attempt at the decompiled source code.
                    <pre>
                        <code class="language-C">
int checked_against[] = {0xCFE,0x859,0x95D,0x871,0x40D,6,0xADE,0xFA8,0x561,0x9DA, \
    0x878,0x682,0xFA9,0xF5F,0x25E,0xDB0,0xFBF,0xBC6,0xD38,0x95D,0xD09,0x7ED,0x307, \
    0x1C0,0x399,0x956,0xA45,0x292,0xC8A,0x92F,0x4A,0x964,0x194,0x9DA,0x11F};
int main(){
    char input[35];
    scanf("%s",input);
    int i;
    if(strlen(input) == 35){
        srand(7777);
        for(i = 0; i &lt sizeof(input);  i++){
            int random = rand();
            int x = clrlwi(random); //zero out bits
            int y = input[i]^x;
            input[i]= y;
        } 
        for(i=0; i&lt sizeof(input); i++)
            if(input[i] != checked_against[i]){
                goto FAIL;
            }
        }
        printf("Good job!! now you can submit your flag :)");
    }
    else{
        FAIL:
        printf("Your flag is incorrect :(");
    }
        return 0;
}
                        </code>
                    </pre>

                    There is a global array containing values that are checked against user input.
                    <img src="../img/hitcon.2016.flame.checked_against.png" alt="" />

                    I'm not sure what the C equivalent of <code>clrlwi</code> is, but what that instruction does is clear out the most significant bits of of its argument. So <code>clrlwi(0xdeadbeef)</code> would return <code>0x000000eef</code>. Because <code>rand</code> is seeded by <code>7777</code>, I can just reproduce this to get the random values that will be <code>xor</code>d with user input. Here is my <code>Get_Rands.c</code>

                    <pre>
                        <code class="language-c">
#include &ltstdio.h&gt
#include &ltstdlib.h&gt

int main(int argc, const char *argv[])
{
    srand(7777);
    int i;
    for (i = 0; i &lt 35; i++) {
       int random = rand();
       printf("%8x\n",random) ;
    }
    return 0;
}
                        </code>
                    </pre>
                    After getting these values, I just manually cleared out the most significant bits. Here is my <code>decrypt.py</code>

                    <pre>
                        <code class="language-python">
A = [0xCFE,0x859,0x95D,0x871,0x40D,6,0xADE,0xFA8,0x561,0x9DA,0x878,0x682,0xFA9,
        0xF5F,0x25E,0xDB0,0xFBF,0xBC6,0xD38,0x95D,0xD09,0x7ED,0x307,0x1C0,0x399,
        0x956,0xA45,0x292,0xC8A,0x92F,0x4A,0x964,0x194,0x9DA,0x11F]

B = [0xc96,0x830,0x929,0x812,0x462,0x068,0xaa5,0xff8,0x551,0x98d,0x84b,0x6f0,0xff9,
        0xf3c,0x201,0xdd1,0xf8d,0xbf4,0xd0b,0x910,0xd31,0x7a1,0x37e,0x19f,0x3a8,0x964,
        0xa1a,0x2e1,0xcba,0x970,0x079,0x950,0x1a1,0x9a3,0x162]


flag = ""
for i in range(0,35):
    flag += chr(A[i]^B[i])
print flag
                        </code>
                    </pre>

                    <pre>
hitcon{P0W3rPc_a223M8Ly_12_s0_345y}
                    </pre>
                    <h1 id= "hand-crafted">Handcrafted pyc (Reversing-50)</h1>
                    soon to come
                    
                </div>
            </div>
        </div>
    </article>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="https://twitter.com/_kablaa">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/kablaa">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="../js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../js/clean-blog.min.js"></script>

</body>

</html>
